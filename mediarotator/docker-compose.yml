version: '3.8'

services:
  # Always-on Services
  
  threadfin:
    image: fyb3roptik/threadfin:latest
    container_name: mediacycler-threadfin
    environment:
      - TZ=America/New_York
      - PUID=1000
      - PGID=1000
    ports:
      - "34400:34400"
    volumes:
      - ./threadfin/data:/home/threadfin/conf
    restart: unless-stopped
    networks:
      - mediacycler

  trailarr:
    image: nandyalu/trailarr:latest
    container_name: mediacycler-trailarr
    environment:
      - TZ=America/New_York
      - PUID=1000
      - PGID=1000
    ports:
      - "7889:7889"
    volumes:
      - ./trailarr/trailarr_data:/config
      - /mnt/netstorage/Media/Movies:/movies:ro
      - /mnt/netstorage/Media/TV:/tv:ro
    restart: unless-stopped
    networks:
      - mediacycler

  encodarr:
    build:
      context: ./encodarr
      dockerfile: Dockerfile
    container_name: mediacycler-encodarr
    environment:
      - TZ=America/New_York
    ports:
      - "5000:5000"
    volumes:
      - /mnt/netstorage/Media:/media:rw
      - ./Encodarr/logs:/app/logs
    restart: unless-stopped
    networks:
      - mediacycler

  mediarotator:
    build:
      context: ./mediarotator
      dockerfile: Dockerfile
    container_name: mediacycler-rotator
    environment:
      - TZ=America/New_York
      - RADARR_API_KEY=${RADARR_API_KEY}
      - SONARR_API_KEY=${SONARR_API_KEY}
      - RADARR_URL=${RADARR_URL}
      - SONARR_URL=${SONARR_URL}
      - RADARR_QUALITY_PROFILE_ID=${RADARR_QUALITY_PROFILE_ID}
      - SONARR_QUALITY_PROFILE_ID=${SONARR_QUALITY_PROFILE_ID}
      - SONARR_LANGUAGE_PROFILE_ID=${SONARR_LANGUAGE_PROFILE_ID}
      - MOVIE_ROOT_FOLDER=${MOVIE_ROOT_FOLDER}
      - SHOW_ROOT_FOLDER=${SHOW_ROOT_FOLDER}
      - SEEDBOX_SYNC_ENABLED=${SEEDBOX_SYNC_ENABLED}
      - SEEDBOX_HOST=${SEEDBOX_HOST}
      - SEEDBOX_USER=${SEEDBOX_USER}
      - SEEDBOX_PORT=${SEEDBOX_PORT}
      - SEEDBOX_MOVIES_PATH=${SEEDBOX_MOVIES_PATH}
      - SEEDBOX_TV_PATH=${SEEDBOX_TV_PATH}
      - SEEDBOX_MOVIES_DEST=${SEEDBOX_MOVIES_DEST}
      - SEEDBOX_TV_DEST=${SEEDBOX_TV_DEST}
      - SEEDBOX_CLEANUP_DELAY_HOURS=${SEEDBOX_CLEANUP_DELAY_HOURS}
      - SEEDBOX_SSH_KEY_PATH=${SEEDBOX_SSH_KEY_PATH}
      - SEEDBOX_SSH_STRICT_HOST_KEY_CHECKING=${SEEDBOX_SSH_STRICT_HOST_KEY_CHECKING}
      - SEEDBOX_SSH_EXTRA_ARGS=${SEEDBOX_SSH_EXTRA_ARGS}
    volumes:
      - mediarotator_cache:/root
      - ./last_media_change.txt:/app/last_media_change.txt
      - /mnt/netstorage/Media:/mnt/netstorage/Media:rw
      - /home/braydenchaffee/.ssh:/root/.ssh:rw
    restart: unless-stopped
    networks:
      - mediacycler

  # Tunarr (Development Mode - typically not run via docker-compose in dev)
  # Uncomment if you want to run Tunarr in production mode
  # tunarr:
  #   image: chrisbenincasa/tunarr:latest
  #   container_name: mediacycler-tunarr
  #   environment:
  #     - TZ=America/New_York
  #   ports:
  #     - "8000:8000"
  #   volumes:
  #     - ./tunarr/config:/config
  #     - ./tunarr/database:/database
  #   restart: unless-stopped
  #   networks:
  #     - mediacycler

networks:
  mediacycler:
    driver: bridge
    name: mediacycler_network

volumes:
  threadfin_data:
    driver: local
  trailarr_data:
    driver: local
  encodarr_logs:
    driver: local
  mediarotator_cache:
    driver: local
